# 株価予測アプリ

このアプリは、指定した銘柄の過去データをもとに株価予測を行い、チャート表示・履歴保存ができる Web アプリです。
モデルを切り替えることで予測結果も変わります。検索履歴からお気に入りに登録することもできます。

構成は下記です。

```
BTC-FULLSTACK/
├── client/           # React フロントエンド
├── server/           # Node.js + Express バックエンドAPI
├── ER図              # DB構成（ER図）
└── README.md
```

## 🖥 使用技術

- フロントエンド React
- バックエンド Node.js, Express, Knex.js, PostgreSQL
- その他 Yahoo Finance API

## 🚀 起動方法

- [ ] このレポジトリをクローンした後、 `cd server　npm install` を実行して必要なパッケージをインストールしてください。
- [ ] 次の作業では、 `npm build` を実行して client ディレクトリにあるコードを`sever/public`にビルドします。
- [ ] 次の作業では、ローカル環境で Postgres が起動している必要があります。Postgres のインスタンスを起動し、`stock_app` という名前のデータベースを作成してください。
  > **補足**: データベースを作成するための `psql` クエリは `CREATE DATABASE stock_app;` です。
- [ ] 次の作業では、`sever/`直下に`.env`ファイルを作成し以下の環境変数を設定してくだっさい

```
DB_NAME=stock_app
DB_USER=<yourusername> //DB作成時のユーザーネームです。
```

- [ ] `npm run migrate-latest`でマイグレーションを実行して、データベースの状態を最新にしてください。このコマンドは `package.json` の `scripts` セクションに記載されています。

  > **注意**: この段階で一番多いエラーはデータベース接続エラーです。マイグレーションが失敗した場合は、Postgres が起動しているか、また `src/knexfile.js` に設定されている Postgres のユーザー名・パスワードが実際の環境と一致しているかを確認してください。

- [ ] `npm run dev` を使ってアプリを起動し、ブラウザで `localhost` にアクセスしてください（ポート番号は `index.js` に記載されています）。

## 🍎 予測モデル

- model1 : 幾何ブラウン運動に基づくモデル。<br />
  指定した期間のリターン(日次平均暴騰率)とリスク（日次標準偏差）から予測値を算出。ランダム値があるため、毎回結果は変わる。

- model2 : 幾何ブラウン運動に基づくモデルによるシミュレーションを 300 回繰り返して平均を取ったモデル。<br />
  幾何ブラウン運動は標準偏差によるランダム要素があるため複数回のシミュレーションで精度 UP。回数増やすほど精度上がるが、リアルタイム処理だとこのくらいが丁度良さそう。精密なシミュレーションしたい人は`/server/routers/predictRouter.js`内の`simulatedCount`の値を変更してください。

## 🔄 機能一覧

- 🔍 銘柄検索 株式シンボル（例: AAPL）と予測範囲、使用モデルで株式データ取得
- 📊 チャート表示 実株価・予測値を表示
- 📁 ログインユーザ毎に履歴保存・呼出 過去の検索履歴を保持・クリックで復元
- 📁 履歴からチェックした銘柄または model のチャートを比較できる比較モード。<br />
  ※同じ range でしか比較できません
- ⭐️ お気に入り登録機能：検索履歴からお気に入りに登録することができ、検索履歴の下にお気に入りのポートフォリオが作成されます。ポートフォリオ全体の年次平均リターンとリスクが表示されます。
- ⭐️ ポートフォリオチャート表示機能：お気に入り登録したポートフォリオの過去の株価と予測した株価の合算値でチャート表示します。<br />
  ※同じ range でお気に入り登録しないと表示されません。<br />
  ※通貨単位があってない場合も補正せず合算されるため、通貨が異なる国でポートフォリオ組む場合はチャート縦軸の値は参考です。

## 🤔 今後追加予定機能

- 比較チャートでお互いの縦軸を合わせる相対比較モード
- ろうそく足チャートモード
- ポートフォリオ全体のチャート表示で通貨補正を入れる
- テクニカル指標（移動平均など）も表示できるようにする
- バグの修正（下記後述）
- モデルの追加：SVR や XGBoost などマシーンラーニングモデルを選択できるようにする。

### 予期せぬ動作（バグ修正）

- お気に入り登録された銘柄と同じ`銘柄-model-range`で再検索してリロードすると、その銘柄がお気に入りから取り除かれる。<br />
  → 再検索時にそのデータをお気に入りデータにも更新するようにする。<br />
  原因（メモ）：同条件の再検索時、`histories`の DB を更新して古いものを削除するため。お気に入りリストは`histories`テーブルの`favorite`カラムで管理しており、更新時`false`が入る仕様になっている。`true`だとお気に入りに入る
